# Cosmic Clicker Project Memory

## File Structure (as of roadmap creation)

- .bolt/ — (unknown, possibly build or config)
- dist/ — Build output
- public/
  - click-sound.mp3 — Click sound effect
  - nebula-background.svg — Nebula background image
  - icons/
    - clicker.png: Main clicker button
    - star.png: Stardust, passive upgrades, and stardust counter
    - rocket.png: Rush Events icon, event upgrades
    - shop.png: Upgrades/shop icon
    - stats.png: Stats panel icon
    - setting.png: Settings icon
    - achievements.png: Achievements icon
    - meteor.png: Meteor rush event visual
    - blackhole.png: Black hole rush event visual
- src/
  - App.tsx — Main app entry
  - main.tsx — React entry point
  - index.css — Global styles
  - vite-env.d.ts — Vite/TypeScript types
  - components/
    - Background.tsx — Animated background (stars, meteors)
    - ClickFeedback.tsx — Click feedback animation
    - GalaxyClicker.tsx — Main clicker button and animation
    - Game.tsx — Main game layout and panel arrangement
    - RushEventAnimation.tsx — Rush event visual effects
    - StarParticles.tsx — Star/falling particle animation
    - StardustCounter.tsx — Stardust and passive income display
    - StatsPanel.tsx — Game stats and upgrade levels
    - UpgradeItem.tsx — Single upgrade display
    - UpgradesPanel.tsx — Upgrades tab/panel
    - AchievementsPanel.tsx
  - context/
    - GameContext.tsx — Game state, upgrades, events
  - utils/
    - gameUtils.ts
- index.html — Main HTML entry
- package.json — Project dependencies
- package-lock.json — Dependency lockfile
- tailwind.config.js — Tailwind CSS config
- vite.config.ts — Vite config
- tsconfig*.json — TypeScript configs
- roadmap.md — Project roadmap and goals
- memory.md — (this file)

## Key Notes
- Main gameplay is in `src/components/Game.tsx` and `GalaxyClicker.tsx`.
- Upgrades and rush events are managed in `GameContext.tsx`.
- Visual/UI issues (e.g., weird box) may be caused by containers in `Game.tsx`, `GalaxyClicker.tsx`, or background overlays.
- Rush events and event chance upgrades are planned for future milestones.
- The key for active events in RushEventsPanel.tsx now uses event.id + '-' + event.startedAt to prevent duplicate key warnings.
- All major changes should be committed to the [SK-Digital/cosmic-clicker](https://github.com/SK-Digital/cosmic-clicker) repo.

---

Update this file whenever the file structure or major project details change. 

- Updated `Background.tsx` to improve the falling star animation with smoother transitions.
- Adjusted z-index and layout in `Game.tsx` to resolve the weird box issue by ensuring proper layering of elements.
- Fixed meteor (falling star) animation in `Background.tsx` to use the correct animation class and improved the visual style for a more realistic shooting star effect.
- Updated `StardustCounter.tsx` to make the resource panel less boxy and better blended with the background. 

# Project File Structure (as of latest update)

- .git/
- .gitattributes
- .gitignore
- dist/
- eslint.config.js
- index.html
- memory.md
- package-lock.json
- package.json
- postcss.config.js
- public/
- roadmap.md
- src/
  - App.tsx
  - components/
    - Background.tsx  # Contains star and meteor (falling star) animation logic
    - ClickFeedback.tsx
    - GalaxyClicker.tsx
    - RushEventAnimation.tsx
    - StarParticles.tsx
    - StardustCounter.tsx
    - StatsPanel.tsx
    - UpgradeItem.tsx
    - UpgradesPanel.tsx
    - Game.tsx
    - AchievementsPanel.tsx
  - context/
  - index.css         # Contains animation keyframes and utility classes
  - main.tsx
  - utils/
    - gameUtils.ts    # Contains generateRandomStars and generateRandomMeteors
  - vite-env.d.ts
- tailwind.config.js
- tsconfig.app.json
- tsconfig.json
- tsconfig.node.json
- vite.config.ts

# Playwright
- Playwright is installed as a dependency (@playwright/test), and a basic Playwright config (playwright.config.ts) is present. UI tests will be placed in the 'tests' directory.

# Animation Logic
- Star and meteor (falling star) animations are implemented in src/components/Background.tsx, with data generated by src/utils/gameUtils.ts.
- Animation keyframes and utility classes are defined in src/index.css.

# Next Steps
- Refine the falling star (meteor) animation in Background.tsx and related CSS.
- Add Playwright config and a basic UI test for visual review.

# Recent Changes
- Refined the falling star (meteor) animation in src/components/Background.tsx to use a glowing head and fading tail, with a more natural diagonal path.
- Added a new CSS class and keyframes (animate-meteor-refined, meteor-refined) in src/index.css for the improved shooting star effect.
- Updated StardustCounter panel in src/components/StardustCounter.tsx to be less boxy, more glassy, and better blended with the background.
- Falling star (meteor) animation now only uses a glowing orb for each meteor—no trail or line, just a soft, glowing head.
- Backdrop-blur has been removed from the StardustCounter panel for a cleaner look.
- StardustCounter panel is now fully transparent and non-boxy, blending seamlessly with the background.
- Falling stars (meteors) are now simple, small, twinkling white dots (2-4px), with no glow, trail, or orb effect.
- Fixed duplicate key warning in src/components/RushEventsPanel.tsx by using event.id + '-' + event.startedAt as the key for active events.
- Improved black hole rush event animation in src/components/RushEventAnimation.tsx: now perfectly centered and sized to match the clicker, with a swirling accretion disk, intense circular glow, and a more realistic black hole core.
- Improved meteor rush event animation in src/components/RushEventAnimation.tsx: meteors are now more visible, animate smoothly, and the animation is properly cleaned up when the event ends.
- The BlackHole rush event animation in `RushEventAnimation.tsx` is now centered in the right 75% of the screen (using a wrapper with marginLeft: 25vw and width: 75vw) to avoid overlapping the stat/currency box on the left.
- All rush event animations are now visually impressive, cosmic-feeling, and strictly tied to the event lifecycle for performance and polish.
- **AchievementsPanel.tsx** now uses the achievements state from GameContext, so progress bars and unlocks reflect actual game state, not a static list.
- **GameContext.tsx**:
  - Added `totalClicks` to `GameState` and initialState.
  - The reducer now increments `totalClicks` on every click and uses it for the 'hundred-clicks' achievement progress.
  - On LOAD_GAME, `totalClicks` is loaded (or set to 0 if missing) and used to recalculate achievement progress.
  - Added `totalUpgradesBought` and `totalEventsTriggered` to `GameState` and initialState.
  - `totalUpgradesBought` increments on every upgrade purchase.
  - `totalEventsTriggered` increments on every rush event start.
  - Both stats persist and are loaded from save.
- **StatsPanel.tsx**:
  - Added a new "Lifetime Stats" section at the top.
  - Displays: Total Clicks, Total Upgrades Bought, Total Events Triggered, Total Stardust Earned, Stardust Spent.

## File Structure (key files)
- src/components/RushEventAnimation.tsx: Handles rush event animations (meteor shower, black hole rift). Now includes .rush-meteor and .rush-blackhole wrappers for testability.
- src/components/Game.tsx: Main game logic, mounts RushEventAnimation for active events.
- tests/rushEvents.spec.ts: Playwright tests for event animations, expects .rush-meteor and .rush-blackhole selectors.

## Notes
- `.rush-meteor` (MeteorShower) and `.rush-blackhole` (BlackHole) wrappers are required for E2E tests to detect and verify animation overlays.
- Animation logic and cleanup are handled in RushEventAnimation.tsx; parent unmounts on onComplete.

## Achievements System
- Achievements are tracked in `state.achievements`.
- Progress bars and unlocks in the UI are now always in sync with the actual game state.
- The 'hundred-clicks' achievement is based on `totalClicks` and persists across reloads.

## Lifetime Stats System
- Lifetime stats are now tracked and displayed for player progression and future achievements/prestige features.

## Outstanding/Next Steps
- Ensure all achievements are tracked and displayed correctly as new ones are added.
- Continue to follow clicker_phases.md and roadmap.md for next features (prestige, sound/settings, etc.).
- Consider renaming StatsPanel to LifetimeStatsPanel for clarity as the stats system expands.

- The icon buttons in the top bar (Rush Events, Upgrades, Achievements, Stats, Settings) are now hidden when any overlay panel is open (shop, rush events, achievements, stats, or settings), to prevent UI overlap and visual clutter. (src/components/Game.tsx)

- Prestige system added: Game state now tracks prestigeCount (number of prestiges), prestigeCurrency (permanent bonus, e.g. cosmic shards), and totalStardustEarned. When the PRESTIGE action is triggered, all progress except achievements and prestige stats is reset. Prestige currency is earned as floor(sqrt(totalStardustEarned / 1,000,000)), and each prestige increases a permanent stardust multiplier by 10%. Achievements are retained on prestige.

- The stats panel now displays prestige stats (prestigeCount, prestigeCurrency, stardust multiplier) and includes a prestige button with a confirmation modal. The prestige system is fully implemented and tested. Next up: achievements polish and audio integration.
